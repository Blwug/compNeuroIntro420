* Integrate and Fire Neurons
  In this section we take a look at the history and math of the computational model of neuron firing called "Integrate and Fire".

  Although relatively simple (not much harder than modelling and plotting a spring) it is still used [[https://scholar.google.com/scholar?as_ylo=2020&q=%22integrate+and+fire%22+neuron&hl=en&as_sdt=7,39][abundantly]] in computational neuroscience research.


** Origins
*** Lapicque - Earlier Computational Neuroscientist
**** Original Paper
[[https://link.springer.com/content/pdf/10.1007/s00422-007-0190-0.pdf][Original French Paper (scanned); pdf]]
**** Image of the Laboratory
[[https://upload.wikimedia.org/wikipedia/commons/a/ac/Lapicque_laboratoire.jpg]]
**** Modern Commentary on the Work
[[http://www.snv.jussieu.fr/brette/papers/Lap07.pdf][Commentary on Lapique's 1907 Paper (pdf)]]
**** Brief Biographical Details of Lapicque
[[https://fr.wikipedia.org/wiki/Louis_Lapicque][Louie Lapicque]]

*** When was the Action Potential Demonstrated?
[[https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1420429/pdf/jphysiol01990-0084.pdf][Lord Adrian 1912 Paper (pdf)]]

** Good, Free Online Books on Computational Neuroscience
 
*** [[https://ocul-wtl.primo.exlibrisgroup.com/discovery/fulldisplay?docid=alma9951382083505162&context=L&vid=01OCUL_WTL:WTL_DEFAULT&lang=en&search_scope=OCULDiscoveryNetwork&adaptor=Local%20Search%20Engine&tab=OCULDiscoveryNetwork&query=any,contains,britt%20anderson&mode=basic][My book]]
   I wrote this about a decade ago when students were much less prepared for this sort of material. some of the sections begin with exercises in Excel and it includes some commentary on different programming constructs and languages. There are later chapters on things like agent based learning that we never get to in our one term course. All that is to say that you may have friends who find the beginning chapters useful, and that you might find things you want to pursue in the later chapters independently. You can read it for free on-line through the library.

*** [[https://lcnwww.epfl.ch/gerstner/SPNM/SPNM.html][Gerstner and Kistler /Spiking Neurons/]]

*** [[http://neuronaldynamics.epfl.ch/online/index.html][Gerstner et al /Neuronal Dynamics/]]

** The Integrate and Fire Equation

$$\tau \frac{dV(t)}{dt} = -V(t) + R~I(t)$$

*** Formula Discussion Questions
**** What does $\frac{dV}{dt}$ mean?
:PROPERTIES:
:QUESTION: It is the derivative. It is the how the voltage changes as a function of how time changes.
:END:

**** What does $\frac{1}{\tau}$ mean?
:PROPERTIES:
:Question: It is the membrane time constant and can be related to the membrane capacitance. Since it is a constant, with a clever choice of units you can assume it to be one and make it disappear.
:END:

**** Why does the voltage term on the right have a negative sign?
:PROPERTIES:
:QUESTION: To get the intuition of a model you don't always have to compute things. You can also get some qualitative behaviour just by looking at it. The larger the voltage the more negative becomes its rate of change and vice versa. It drives everything back to some point at which the rate of change to an equilibrium point. We will come back to this notion of a fixed point or attractor.
:END:

**** What is $I(t)$?
:PROPERTIES:
:QUESTION: It is the current term. $I$ is the common abbreviation for current. Why? I don't know, can someone help?
:END:

**** Put it all together
:PROPERTIES:
:QUESTION: The voltage in the future will be a sum of whatever current is being added minus a function of the current voltage.
:END:

**** Why, if we don't reach a threshold to fire an action potential, do we see an exponential decay?  
:PROPERTIES:
:QUESTION: This is where you need to remember what came before. See that the change in voltage is proportional to itself. Solutions to these types of equations involve exponentials. Remember? But note the sign. It is negative. That is why it is an exponential decay instead of an exponential growth.
:END:

*** Where does the leaky integrate and fire *equation* come from? :class_exercise:

**** Write and explain Ohm's law
:PROPERTIES:
:QUESTION: *Ohm's Law* (empirically observed): $V = IR$
:END:

**** Explain what is the relationship between current and charge?
:PROPERTIES:
:QUESTION: Current: The derivative of charge with respect to time, $$I = \frac{dQ}{dt}$$
:END:


**** Explain *Kirchoff's Point Rule*
:PROPERTIES:
:QUESTION: Current sums to zero: All the current sources going to a node in a circuit must sum to zero.
:END:

**** What is capacitance?
:PROPERTIES:
:QUESTION: Capacitance is a source of current. A capacitor is a sandwich of two conducting surfaces with a non-conducting body in between. If you a charge to one side, the electrons gather there. They can't leap the gap, so they exert an attraction for particles of the opposite charge on the other side of the gap. If you suddenly stop the charge then charge races around and you discharge a current.
:END:

**** Explain the relationship, mathematically, between capacitance, charge, and voltage.
:PROPERTIES:
:QUESTION: $C = Q/V.$ The volume of charge, per unit area, divided by the voltage that produces this imbalance in charge.
:END:

**** What happens when you differentiate this equation with respect to time and treat the capacitance as a constant?
:PROPERTIES:
:QUESTION: $C \frac{dV}{dt} = \frac{dQ}{dt} = I$
:END:

*** Deriving the IandF Equation
#+Name: Deriving the Integrate and Fire Equation
#+header: :headers '("\\usepackage{amsmath}")
#+header: :exports results
#+options: tex:t
#+begin_src latex :results raw
  \begin{align*}
    I &= I_R + I_C \\
      &= I_R + C\frac{dV}{dt} \\
      &= \frac{V}{R} + C\frac{dV}{dt}\\
    RI  &= V + RC\frac{dV}{dt} \\
    \frac{1}{\tau}(RI-V)  &= \frac{dV}{dt}\\
  \end{align*}						  
#+end_src

#+RESULTS:
\begin{align*}
  I &= I_R + I_C \\
    &= I_R + C\frac{dV}{dt} \\
    &= \frac{V}{R} + C\frac{dV}{dt}\\
  RI  &= V + RC\frac{dV}{dt} \\
  \frac{1}{\tau}(RI-V)  &= \frac{dV}{dt}\\
\end{align*}



** Coding up the Integrate and Fire Neuron
#+begin_src lisp :results silent
  (ql:quickload :eazy-gnuplot)
  (use-package :eazy-gnuplot)
#+end_src

This is almost the same as the spring example. You can use that as a guide.

#+Name: Define Constants
#+begin_src lisp :results silent
  (defconstant +dt+ 0.05)
  (defconstant +max-t+ 10)
  (defconstant +init-t+ 0.0d0)
  (defconstant +start-time+ 1.0d0)
  (defconstant +stop-time+ 4.0d0)
  (defvar *injection-time* (cons +start-time+ +stop-time+))
  (defconstant +cap+ 1) 
  (defconstant +res+ 2)
  (defconstant +threshold+ 4)
  (defconstant +spike-display+ 8.0d0) ;arbitrary value used for "pasting on" a spike. Not needed, just nice for display.
  (defvar *tau* (* +res+ +cap+))
  (defconstant +init-v+ 0)
  (defvar *voltage* +init-v+)
  (defconstant +injection-current+ 2.3d0)
#+end_src

#+begin_src lisp :results silent
  (defun update (old-value rate-of-change time-step)
    (+ (* rate-of-change time-step) old-value))
#+end_src
#+begin_src lisp :results silent
    (defun dv-dt (&key R I V (tau *tau*))
      (* (/ 1 tau) (- (* R I) V)))
#+end_src

#+begin_src lisp :results silent
    (defun run-iandf-sim ()
      (flet ((between (x) (if (and (>= x (car *injection-time*))
				   (<= x (cdr *injection-time*))) +injection-current+ 0.0))
	     (voltage-choice (cv b)
			      (cond
				((and (> cv +threshold+) (not b)) +spike-display+)
				(b 0.0d0)
				(t cv))))
      (loop
	for tme = +init-t+ then (+ +dt+ tme)
	for i = (between tme) then (between tme)
	for spike = nil then (< (abs (- voltage-now +spike-display+)) 0.1d0))
	for voltage-now = +init-v+ then (voltage-choice (dv-dt :R +res+ :I i :V voltage-now) spike)
	collect (list tme i voltage-now)
	while (< tme +max-t+))))
#+end_src

#+begin_src lisp 
    (defun iandf-plot (output)
      (let ((data (run-iandf-sim)))
	(with-plots (*standard-output* :debug nil)
	  (gp-setup :output output :terminal :png)
	  (plot
	   (lambda ()
	     (loop for p in data
		   do (format t "~&~a ~a" (first p) (third p))))
	   :with '(:lines))))
      output)
#+end_src

#+RESULTS:
: IANDF-PLOT


#+begin_src lisp :exports both :results graphics file "iandf.png"
  (iandf-plot "iandf.png")
#+end_src

#+RESULTS:
a[[file:iandf.png]]








